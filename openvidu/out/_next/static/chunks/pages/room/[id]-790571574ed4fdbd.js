(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[120],{7865:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/room/[id]",function(){return t(3614)}])},7337:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return a}});var o=t(5893),r=t(7294);function a(e){let n=e.streamManager,t=(0,r.useRef)(null);return navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{t.current.srcObject=e}).catch(e=>{e.response?router.push({pathname:"/exception",query:{msg:e.response.data}}):console.log(e)}),(0,r.useEffect)(()=>{n&&!t&&n.addVideoElement(t.current)},[t]),(0,o.jsx)("span",{children:(0,o.jsx)("video",{autoPlay:!0,ref:t})})}},3626:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return m}});var o=t(2729),r=t(5893),a=t(508),s=t(7294),i=t(1163),c=t(1649),l=t(5019);function u(){let e=(0,o._)(["\n  font-family: 'LeeSeoyun';\n\n  position:absolute;\n  bottom: 16px;\n  left: 220px;\n\n  background: url(\"/room/bowl.png\") no-repeat center/cover !important; \n  width: 160px;\n  height: 120px;\n  cursor: pointer;\n\n  font-weight: bold;\n  font-size: 24px;\n  color: #000; /* 텍스트 색상 */\n  text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;\n  transition: all 0.3s ease;\n  \n  &:hover {\n    transform: rotate(10deg); /* X축으로 20도만큼 기울임 */\n    font-size: 26px;\n  }\n  "]);return u=function(){return e},e}function d(){let e=(0,o._)(["\n  font-family: 'LeeSeoyun';\n\n  position:absolute;\n  bottom: 16px;\n  right: 450px;\n\n  background: url(\"/room/chapstick.png\") no-repeat center/cover !important; \n  width: 180px;\n  height: 40px;\n  cursor: pointer;\n\n  font-weight: bold;\n  font-size: 24px;\n  color: #000; /* 텍스트 색상 */\n  text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;\n  transition: all 0.3s ease;\n  \n  &:hover {\n    transform: rotate(-10deg); /* X축으로 20도만큼 기울임 */\n    font-size: 26px;\n  }\n  "]);return d=function(){return e},e}function p(){let e=(0,o._)(["\n  font-family: 'LeeSeoyun';\n\n  position:absolute;\n  bottom: 16px;\n  right: 260px;\n\n  background: url(\"/room/pot.png\") no-repeat center/cover !important; \n  width: 180px;\n  height: 120px;\n  cursor: pointer;\n\n  font-weight: bold;\n  font-size: 36px;\n  color: #000; /* 텍스트 색상 */\n  text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;\n  transition: all 0.3s ease;\n  \n  &:hover {\n    transform: rotate(-10deg); /* X축으로 20도만큼 기울임 */\n    font-size: 40px;\n  }\n"]);return p=function(){return e},e}function f(){let e=(0,o._)(["\n  font-family: 'LeeSeoyun';\n\n  position:absolute;\n  bottom: 16px;\n  right: 260px;\n\n  background: url(\"/room/pot.png\") no-repeat center/cover !important; \n  width: 180px;\n  height: 120px;\n  cursor: pointer;\n\n  font-weight: bold;\n  font-size: 36px;\n  color: #000; /* 텍스트 색상 */\n  text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;\n  transition: all 0.3s ease;\n  \n  &:hover {\n    transform: rotate(-10deg); /* X축으로 20도만큼 기울임 */\n    font-size: 40px;\n  }\n"]);return f=function(){return e},e}function m(e){let n=(0,i.useRouter)(),t=(0,c.I0)(),o=a.ZP.button(u()),m=a.ZP.button(d()),h=a.ZP.button(p()),x=a.ZP.button(f()),g=e.info,[v]=(0,s.useState)(e.client),_=(0,s.useState)(e.ready);console.log("ready ::: ",_);let y=(0,c.v9)(e=>e.room.currentIncludeMini),b=(0,c.v9)(e=>e.room.currentRoomId),N="https://ohogame.shop/enter/room/?roomId="+b;console.log("생성 url"),console.log(N);let w=()=>{navigator.clipboard.writeText(N),alert("클립보드에 URL이 복사되었습니다.")},j=()=>{let e={playerId:g.playerId,ready:_};v.current.send("/ready/".concat(g.roomId),{},JSON.stringify(e))};return(0,r.jsxs)("div",{style:{marginTop:"20px"},children:[(0,r.jsx)(o,{onClick:()=>{t((0,l.eA)())},children:!0==y?"미니게임 모드":"기본 모드"}),(0,r.jsx)(m,{onClick:()=>{w()},children:"초대하기"}),!0===e.head?(0,r.jsx)(x,{onClick:()=>{n.push({pathname:"/game/".concat(null==g?void 0:g.roomId),query:{currentName:JSON.stringify(g)}})},children:"시 작"}):(0,r.jsxs)(h,{onClick:()=>{j()},children:[" ",!1===e.ready?"준 비":"준비완료"]})]})}},6788:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return u}});var o=t(5893);t(7294);var r=t(7337),a=t(1649),s=t(9255),i=t.n(s),c=t(4533),l=t.n(c);function u(){let e=(0,a.v9)(e=>e.room.currentRoomId),n=(0,a.v9)(e=>e.player.currentNick),t=(0,a.v9)(e=>e.openvidu.publisher),s=(0,a.v9)(e=>e.openvidu.participants);return console.log("룸캠"),console.log(t),console.log(s),(0,o.jsx)("div",{className:"container",children:void 0!==e?(0,o.jsx)("div",{id:"session",children:(0,o.jsxs)("div",{id:"video-container",className:i().camList,children:[void 0!==t?(0,o.jsxs)("span",{className:l().streamcomponent,children:[(0,o.jsx)(r.default,{className:i().cam,streamManager:t}),(0,o.jsx)("div",{className:l().nickname,children:n})]}):null,null!=s?s.map((e,n)=>(0,o.jsxs)("span",{className:l().streamcomponent,children:[(0,o.jsx)(r.default,{className:i().cam,streamManager:e}),console.log(e.nick),(0,o.jsx)("div",{className:l().nickname,children:e.nick})]},e.id)):null]})}):null})}},9180:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return i}});var o=t(5893),r=t(7294),a=t(9255),s=t.n(a);function i(e){let n=e.info,[t]=(0,r.useState)(e.client);console.log(n),console.log(t);let[a,i]=(0,r.useState)(""),[c,l]=(0,r.useState)(""),[u,d]=(0,r.useState)(0),[p,f]=(0,r.useState)(!0),m=e=>{i(e.target.value)},h=e=>{"Enter"===e.key&&(e.preventDefault(),x(),i(""))},x=()=>{if(l(a),c===a){if(d(u+1),u>=4){f(!1),alert("5회 이상 같은 채팅을 입력하셨습니다."),d(0),i("");return}}else d(0);if(""===a)alert("입력된 메시지가 없습니다.");else if(t.current){var e={playerId:n.nick,message:a};t.current.send("/chat/"+n.roomId,{},JSON.stringify(e))}i("")};(0,r.useEffect)(()=>{let e=setTimeout(()=>{f(!0)},15e3);return()=>clearTimeout(e)},[p]);let g=(0,r.useRef)(null);(0,r.useEffect)(()=>{g.current&&(g.current.scrollTop=g.current.scrollHeight)},[e.chatHistory]);let v=()=>{if(""===a){var e={playerId:"입장 알림봇",message:"".concat(n.nick,"님이 입장하셨습니다.")};t.current.send("/chat/"+n.roomId,{},JSON.stringify(e))}i("")};return(0,r.useEffect)(()=>{setTimeout(()=>{v()},500)},[]),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:s().outerChat,children:(0,o.jsx)("div",{className:s().innerChat,children:(0,o.jsx)("textarea",{ref:g,className:s().chatArea,readOnly:!0,value:e.chatHistory})})}),p?(0,o.jsx)("input",{type:"text",className:s().chatInput,value:a,onChange:m,onKeyDown:h}):null,p?null:(0,o.jsx)("input",{type:"text",className:s().chatInput,placeholder:"15초 후에 채팅이 가능합니다.",value:a,onChange:m,onKeyDown:h,disabled:!0}),(0,o.jsx)("button",{className:s().sendBtn,onClick:x,children:"전송"})]})}},3614:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return y}});var o=t(5893),r=t(7294),a=t(1163),s=t(6788),i=t(9180),c=t(3626),l=t(6154),u=t(8e3),d=t.n(u),p=t(4593),f=t(1649),m=t(7667),h=t(5989),x=t(7033),g=t(4905),v=t(9255),_=t.n(v);function y(){let e=(0,a.useRouter)(),n=(0,f.I0)(),t=e.query.currentName?JSON.parse(e.query.currentName):"",u=new g.OpenVidu,v=u.initSession(),y=(0,f.v9)(e=>e.room.currentRoomId),b=(0,f.v9)(e=>e.player.currentPlayerId),N=(0,f.v9)(e=>e.player.currentNick),w=(0,f.v9)(e=>e.player.currentHead),j=(0,f.v9)(e=>e.player.currentReady),[k,I]=(0,r.useState)({}),[S,P]=(0,r.useState)([]),[R,C]=(0,r.useState)("".concat(t.nick,"님이 입장하셨습니다.")+"\n"),E=()=>{(0,l.Z)({url:"https://ohogame.shop/api"+"/player/".concat(y),header:{Accept:"application/json","Content-type":"application/json;charset=UTF-8"},method:"POST",data:{id:b}}).then(e=>{console.log(e);let t=e.data.length;for(let o=0;o<t;o++){let t={head:e.data[o].head,playerId:e.data[o].id,nick:e.data[o].nickname,ready:e.data[o].ready};n((0,m.DB)(t))}}).catch(n=>{n.response?e.push({pathname:"/exception",query:{msg:n.response.data}}):console.log("error ::: ",n)})},L={},O=()=>{L.current=p.L.over(()=>{let e=new(d())("https://ohogame.shop/ws");return e})},D=()=>{L.current.connect({},()=>{L.current.subscribe("/topic/chat/".concat(y),e=>{var n=JSON.parse(e.body);C(e=>e+n.message+"\n")}),L.current.subscribe("/topic/player/".concat(y),e=>{var t=JSON.parse(e.body);console.log(t),t.id==b&&n((0,h.Cd)(t))})})},T=e=>{M()},J=e=>{let t=S.indexOf(e,0);t>-1&&(S.splice(t,1),P(S),n((0,x.gw)([])),n((0,x.LI)(S)))},H=async e=>{try{v.on("streamCreated",async e=>{let t=v.subscribe(e.stream,void 0),o=[];S.map(e=>{console.log("for문 이내의 참가자"),o.push({par:e}),n((0,x.LI)(e))}),console.log("조인세션"),console.log(JSON.parse(t.stream.connection.data.split("%")[0]).clientData);let r=JSON.parse(t.stream.connection.data.split("%")[0]).clientData;console.log("닉"),console.log(r),n((0,x.LI)({nick:r,participant:t})),o.push({nick:r,participant:t}),P(o)}),v.on("streamDestroyed",e=>{J(e.stream.streamManager)}),v.on("exception",e=>{console.warn(e)}),await v.connect(e,{clientData:N,publisher:!0});let r=await u.initPublisherAsync(void 0,{audioSource:void 0,videoSource:void 0,publishAudio:!0,publishVideo:!0,resolution:"640x480",frameRate:30,insertMode:"APPEND",mirror:!1});await v.publish(r);var t=(await u.getDevices()).filter(e=>"videoinput"===e.kind),o=r.stream.getMediaStream().getVideoTracks()[0].getSettings().deviceId;t.find(e=>e.deviceId===o),I(r),n((0,x.lH)(r))}catch(e){console.log(e)}},M=()=>{v&&v.disconnect(),u=null,I(void 0),P([])};return(0,r.useEffect)(()=>(E(),O(),D(),window.addEventListener("beforeunload",T),H(b),()=>{window.removeEventListener("beforeunload",T)}),[]),(0,o.jsxs)("div",{className:_().container,children:[(0,o.jsx)("div",{className:"roof2"}),(0,o.jsxs)("div",{className:_().room,children:[(0,o.jsx)("div",{className:_().camList,children:(0,o.jsx)(s.default,{})}),(0,o.jsx)(i.default,{info:t,client:L,chatHistory:R}),(0,o.jsx)(c.default,{info:t,client:L,head:w,ready:j})]})]})}},9255:function(e){e.exports={container:"RoomPage_container__nrifP",room:"RoomPage_room__jZJqd",camList:"RoomPage_camList__pr94X",cam:"RoomPage_cam__bKlCM",chatContainer:"RoomPage_chatContainer__Hlg7I",outerChat:"RoomPage_outerChat__j4Ee0",innerChat:"RoomPage_innerChat__ZniE2",chatUnit:"RoomPage_chatUnit__9sfcL",sender:"RoomPage_sender__9HCU2",time:"RoomPage_time__4KvWW",message:"RoomPage_message__3J_1w",chatArea:"RoomPage_chatArea__njIvi",chatInput:"RoomPage_chatInput__xkHum",sendBtn:"RoomPage_sendBtn__836RZ"}},4533:function(e){e.exports={streamcomponent:"UserVideo_streamcomponent__72vDQ",nickname:"UserVideo_nickname__IX3Tw"}}},function(e){e.O(0,[0,154,593,894,905,774,888,179],function(){return e(e.s=7865)}),_N_E=e.O()}]);