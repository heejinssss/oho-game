(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[120],{7865:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/room/[id]",function(){return t(6458)}])},7337:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return a}});var o=t(5893),r=t(7294);function a(e){let n=e.streamManager,t=(0,r.useRef)(null);return navigator.mediaDevices.getUserMedia({video:!0}).then(e=>{t.current.srcObject=e}).catch(e=>{e.response?router.push({pathname:"/exception",query:{msg:e.response.data}}):console.log(e)}),(0,r.useEffect)(()=>{n&&!t&&n.addVideoElement(t.current)},[t]),(0,o.jsxs)("span",{children:[(0,o.jsx)("video",{autoPlay:!0,ref:t}),";"]})}},3626:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return m}});var o=t(2729),r=t(5893),a=t(508),s=t(7294),i=t(1163),c=t(1649),l=t(5019);function u(){let e=(0,o._)(["\n  font-family: 'LeeSeoyun';\n\n  position:absolute;\n  bottom: 16px;\n  left: 220px;\n\n  background: url(\"/room/bowl.png\") no-repeat center/cover !important; \n  width: 160px;\n  height: 120px;\n  cursor: pointer;\n\n  font-weight: bold;\n  font-size: 24px;\n  color: #000; /* 텍스트 색상 */\n  text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;\n  transition: all 0.3s ease;\n  \n  &:hover {\n    transform: rotate(10deg); /* X축으로 20도만큼 기울임 */\n    font-size: 26px;\n  }\n  "]);return u=function(){return e},e}function d(){let e=(0,o._)(["\n  font-family: 'LeeSeoyun';\n\n  position:absolute;\n  bottom: 16px;\n  right: 450px;\n\n  background: url(\"/room/chapstick.png\") no-repeat center/cover !important; \n  width: 180px;\n  height: 40px;\n  cursor: pointer;\n\n  font-weight: bold;\n  font-size: 24px;\n  color: #000; /* 텍스트 색상 */\n  text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;\n  transition: all 0.3s ease;\n  \n  &:hover {\n    transform: rotate(-10deg); /* X축으로 20도만큼 기울임 */\n    font-size: 26px;\n  }\n  "]);return d=function(){return e},e}function p(){let e=(0,o._)(["\n  font-family: 'LeeSeoyun';\n\n  position:absolute;\n  bottom: 16px;\n  right: 260px;\n\n  background: url(\"/room/pot.png\") no-repeat center/cover !important; \n  width: 180px;\n  height: 120px;\n  cursor: pointer;\n\n  font-weight: bold;\n  font-size: 36px;\n  color: #000; /* 텍스트 색상 */\n  text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;\n  transition: all 0.3s ease;\n  \n  &:hover {\n    transform: rotate(-10deg); /* X축으로 20도만큼 기울임 */\n    font-size: 40px;\n  }\n"]);return p=function(){return e},e}function f(){let e=(0,o._)(["\n  font-family: 'LeeSeoyun';\n\n  position:absolute;\n  bottom: 16px;\n  right: 260px;\n\n  background: url(\"/room/pot.png\") no-repeat center/cover !important; \n  width: 180px;\n  height: 120px;\n  cursor: pointer;\n\n  font-weight: bold;\n  font-size: 36px;\n  color: #000; /* 텍스트 색상 */\n  text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;\n  transition: all 0.3s ease;\n  \n  &:hover {\n    transform: rotate(-10deg); /* X축으로 20도만큼 기울임 */\n    font-size: 40px;\n  }\n"]);return f=function(){return e},e}function m(e){let n=(0,i.useRouter)(),t=(0,c.I0)(),o=a.ZP.button(u()),m=a.ZP.button(d()),h=a.ZP.button(p()),x=a.ZP.button(f()),g=e.info,[v]=(0,s.useState)(e.client),_=(0,s.useState)(e.ready);console.log("ready ::: ",_);let y=(0,c.v9)(e=>e.room.currentIncludeMini),b=(0,c.v9)(e=>e.room.currentRoomId),N="https://ohogame.shop/enter/room/?roomId="+b;console.log("생성 url"),console.log(N);let j=()=>{navigator.clipboard.writeText(N),alert("클립보드에 URL이 복사되었습니다.")},w=()=>{let e={playerId:g.playerId,ready:_};v.current.send("/ready/".concat(g.roomId),{},JSON.stringify(e))};return(0,r.jsxs)("div",{style:{marginTop:"20px"},children:[(0,r.jsx)(o,{onClick:()=>{t((0,l.eA)())},children:!0==y?"미니게임 모드":"기본 모드"}),(0,r.jsx)(m,{onClick:()=>{j()},children:"초대하기"}),!0===e.head?(0,r.jsx)(x,{onClick:()=>{n.push({pathname:"/game/".concat(null==g?void 0:g.roomId),query:{currentName:JSON.stringify(g)}})},children:"시 작"}):(0,r.jsxs)(h,{onClick:()=>{w()},children:[" ",!1===e.ready?"준 비":"준비완료"]})]})}},6788:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return d}});var o=t(5893),r=t(7294),a=t(7337),s=t(1649),i=t(9255),c=t.n(i),l=t(4533),u=t.n(l);function d(e){let[n,t]=(0,r.useState)("");console.log("룸캠 렌더링");let i=(0,s.v9)(e=>e.room.currentRoomId),l=(0,s.v9)(e=>e.player.currentNick),d=e.publisher,p=e.participants;return console.log(d),console.log(p),(0,o.jsx)("div",{className:"container",children:void 0!==i?(0,o.jsx)("div",{id:"session",children:(0,o.jsxs)("div",{id:"video-container",className:c().camList,children:[void 0!==d?(0,o.jsxs)("span",{className:u().streamcomponent,children:[(0,o.jsx)(a.default,{className:c().cam,streamManager:d}),(0,o.jsx)("div",{className:u().nickname,children:l})]}):null,p.map((e,n)=>(0,o.jsxs)("span",{className:u().streamcomponent,children:[console.log(JSON.parse(e.stream.connection.data.split("%")[0]).clientData),(0,o.jsx)(a.default,{className:c().cam,streamManager:e}),(0,o.jsx)("div",{className:u().nickname,children:JSON.parse(e.stream.connection.data.split("%")[0]).clientData})]},e.id))]})}):null})}},9180:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return i}});var o=t(5893),r=t(7294),a=t(9255),s=t.n(a);function i(e){let n=e.info,[t]=(0,r.useState)(e.client);console.log("룸챗 컴포넌트"),console.log(n),console.log(t);let[a,i]=(0,r.useState)(""),[c,l]=(0,r.useState)(""),[u,d]=(0,r.useState)(0),[p,f]=(0,r.useState)(!0),m=e=>{i(e.target.value)},h=e=>{"Enter"===e.key&&(e.preventDefault(),x(),i(""))},x=()=>{if(l(a),c===a){if(d(u+1),u>=4){f(!1),alert("5회 이상 같은 채팅을 입력하셨습니다."),d(0),i("");return}}else d(0);if(""===a)alert("입력된 메시지가 없습니다.");else if(t.current){var e={playerId:n.nick,message:a};t.current.send("/chat/"+n.roomId,{},JSON.stringify(e))}i("")};(0,r.useEffect)(()=>{let e=setTimeout(()=>{f(!0)},15e3);return()=>clearTimeout(e)},[p]);let g=(0,r.useRef)(null);(0,r.useEffect)(()=>{g.current&&(g.current.scrollTop=g.current.scrollHeight)},[e.chatHistory]);let v=()=>{if(""===a){var e={playerId:"입장 알림봇",message:"".concat(n.nick,"님이 입장하셨습니다.")};t.current.send("/chat/"+n.roomId,{},JSON.stringify(e))}i("")};return(0,r.useEffect)(()=>{setTimeout(()=>{v()},500)},[]),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:s().outerChat,children:(0,o.jsx)("div",{className:s().innerChat,children:(0,o.jsx)("textarea",{ref:g,className:s().chatArea,readOnly:!0,value:e.chatHistory})})}),p?(0,o.jsx)("input",{type:"text",className:s().chatInput,value:a,onChange:m,onKeyDown:h}):null,p?null:(0,o.jsx)("input",{type:"text",className:s().chatInput,placeholder:"15초 후에 채팅이 가능합니다.",value:a,onChange:m,onKeyDown:h,disabled:!0}),(0,o.jsx)("button",{className:s().sendBtn,onClick:x,children:"전송"})]})}},6458:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return w}});var o=t(5893),r=t(7294),a=t(1163),s=t(6788),i=t(9180),c=t(3626),l=t(6154),u=t(8e3),d=t.n(u),p=t(4593),f=t(1649),m=t(7667),h=t(5989),x=t(7236);let g=(0,x.oM)({name:"openvidu",initialState:{publisher:{},participants:[]},reducers:{setPublisherData:(e,n)=>{e.publisher=n.payload},addParticipants:(e,n)=>{e.participants.push(n.payload)},resetParticipants:(e,n)=>{e.participants=n.payload}}}),{setPublisherData:v,addParticipants:_,resetParticipants:y}=g.actions;var b=t(4905),N=t(9255),j=t.n(N);function w(){let e=(0,a.useRouter)(),n=(0,f.I0)(),t=e.query.currentName?JSON.parse(e.query.currentName):"",u=new b.OpenVidu,x=u.initSession(),g=(0,f.v9)(e=>e.room.currentRoomId),N=(0,f.v9)(e=>e.player.currentPlayerId),w=(0,f.v9)(e=>e.player.currentNick),S=(0,f.v9)(e=>e.player.currentHead),P=(0,f.v9)(e=>e.player.currentReady),[k,I]=(0,r.useState)({}),[R,C]=(0,r.useState)([]),[E,O]=(0,r.useState)("".concat(t.nick,"님이 입장하셨습니다.")+"\n"),D=()=>{(0,l.Z)({url:"https://ohogame.shop/api"+"/player/".concat(g),header:{Accept:"application/json","Content-type":"application/json;charset=UTF-8"},method:"POST",data:{id:N}}).then(e=>{console.log(e);let t=e.data.length;for(let o=0;o<t;o++){let t={head:e.data[o].head,playerId:e.data[o].id,nick:e.data[o].nickname,ready:e.data[o].ready};n((0,m.DB)(t))}}).catch(n=>{n.response?e.push({pathname:"/exception",query:{msg:n.response.data}}):console.log("error ::: ",n)})},L={},T=()=>{L.current=p.L.over(()=>{let e=new(d())("https://ohogame.shop/ws");return e})},J=()=>{L.current.connect({},()=>{L.current.subscribe("/topic/chat/".concat(g),e=>{var n=JSON.parse(e.body);O(e=>e+n.playerId+": "+n.message+"\n")}),L.current.subscribe("/topic/player/".concat(g),e=>{var t=JSON.parse(e.body);console.log(t),t.id==N&&n((0,h.Cd)(t))})})},M=e=>{H()},z=e=>{let n=R.indexOf(e,0);n>-1&&(R.splice(n,1),C(R))},A=async e=>{try{x.on("streamCreated",async e=>{let t=x.subscribe(e.stream,void 0);R.push(t),C(R),n(_(R)),console.log(R)}),x.on("streamDestroyed",e=>{z(e.stream.streamManager)}),x.on("exception",e=>{console.warn(e)}),await x.connect(e,{clientData:w,publisher:!0});let r=await u.initPublisherAsync(void 0,{audioSource:void 0,videoSource:void 0,publishAudio:!0,publishVideo:!0,resolution:"640x480",frameRate:30,insertMode:"APPEND",mirror:!1});await x.publish(r);var t=(await u.getDevices()).filter(e=>"videoinput"===e.kind),o=r.stream.getMediaStream().getVideoTracks()[0].getSettings().deviceId;t.find(e=>e.deviceId===o),I(r),n(v(r)),console.log(k)}catch(e){console.log(e)}},H=()=>{x&&x.disconnect(),u=null,I(void 0),C([]),n(y([]))};return(0,r.useEffect)(()=>(D(),T(),J(),window.addEventListener("beforeunload",M),A(N),()=>{window.removeEventListener("beforeunload",M)}),[]),(0,o.jsxs)("div",{className:j().container,children:[(0,o.jsx)("div",{className:"roof2"}),(0,o.jsxs)("div",{className:j().room,children:[(0,o.jsx)("div",{className:j().camList,children:(0,o.jsx)(s.default,{publisher:k,participants:R})}),(0,o.jsx)(i.default,{info:t,client:L,chatHistory:E}),(0,o.jsx)(c.default,{info:t,client:L,head:S,ready:P})]})]})}},9255:function(e){e.exports={container:"RoomPage_container__nrifP",room:"RoomPage_room__jZJqd",camList:"RoomPage_camList__pr94X",cam:"RoomPage_cam__bKlCM",chatContainer:"RoomPage_chatContainer__Hlg7I",outerChat:"RoomPage_outerChat__j4Ee0",innerChat:"RoomPage_innerChat__ZniE2",chatUnit:"RoomPage_chatUnit__9sfcL",sender:"RoomPage_sender__9HCU2",time:"RoomPage_time__4KvWW",message:"RoomPage_message__3J_1w",chatArea:"RoomPage_chatArea__njIvi",chatInput:"RoomPage_chatInput__xkHum",sendBtn:"RoomPage_sendBtn__836RZ"}},4533:function(e){e.exports={streamcomponent:"UserVideo_streamcomponent__72vDQ",nickname:"UserVideo_nickname__IX3Tw"}}},function(e){e.O(0,[812,154,894,905,774,888,179],function(){return e(e.s=7865)}),_N_E=e.O()}]);